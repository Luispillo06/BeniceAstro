---
import Layout from '../../layouts/Layout.astro';
import { supabase } from '../../lib/supabase';

// Proteger ruta - solo admins
const { data: { session } } = await supabase.auth.getSession();

if (!session) {
  return Astro.redirect('/login');
}

// Verificar rol de admin en la base de datos
const { data: userData } = await supabase
  .from('users')
  .select('role')
  .eq('id', session.user.id)
  .single();

if (!userData || userData.role !== 'admin') {
  return Astro.redirect('/');
}

// Obtener productos
const { data: products, count: totalProducts } = await supabase
  .from('products')
  .select('*', { count: 'exact' })
  .order('created_at', { ascending: false });
---

<Layout title="Panel de Administraci√≥n - Productos">
  <div class="bg-white min-h-screen">
    <div class="max-w-7xl mx-auto px-4 py-6">
      
      <!-- Breadcrumb -->
      <nav class="text-sm mb-4">
        <ol class="flex items-center space-x-2 text-gray-500">
          <li><a href="/" class="hover:text-yellow-600">Inicio</a></li>
          <li><span class="mx-2">‚Ä∫</span></li>
          <li><a href="/admin" class="hover:text-yellow-600">Admin</a></li>
          <li><span class="mx-2">‚Ä∫</span></li>
          <li class="text-gray-800 font-medium">Productos</li>
        </ol>
      </nav>

      <!-- T√≠tulo -->
      <h1 class="text-2xl font-bold text-gray-800 mb-6">Gesti√≥n de Productos Venice</h1>

      <div class="flex gap-8">
        
        <!-- Sidebar de Filtros -->
        <aside class="w-64 flex-shrink-0">
          <div class="sticky top-4">
            <div class="flex items-center gap-2 mb-6">
              <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
              </svg>
              <span class="font-semibold text-gray-700">Filtros</span>
            </div>

            <!-- Especie -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Especie</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-especie" value="perro">
                  <span class="ml-2 text-sm text-gray-700">Perro</span>
                </label>
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-especie" value="gato">
                  <span class="ml-2 text-sm text-gray-700">Gato</span>
                </label>
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-especie" value="otros">
                  <span class="ml-2 text-sm text-gray-700">Otros animales</span>
                </label>
              </div>
            </div>

            <!-- Categor√≠a -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Categor√≠a</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-categoria" value="alimento">
                  <span class="ml-2 text-sm text-gray-700">Alimento</span>
                </label>
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-categoria" value="juguetes">
                  <span class="ml-2 text-sm text-gray-700">Juguetes</span>
                </label>
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-categoria" value="accesorios">
                  <span class="ml-2 text-sm text-gray-700">Accesorios</span>
                </label>
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-categoria" value="salud">
                  <span class="ml-2 text-sm text-gray-700">Salud</span>
                </label>
              </div>
            </div>

            <!-- Productos en Oferta -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Productos en Oferta</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3">
                <label class="flex items-center cursor-pointer hover:text-yellow-600">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400" id="filter-ofertas">
                  <span class="ml-2 text-sm text-gray-700">Solo ofertas</span>
                </label>
              </div>
            </div>

            <!-- Precio -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Precio</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="precio" class="w-4 h-4 border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-precio" value="0-20">
                  <span class="ml-2 text-sm text-gray-700">0‚Ç¨ - 20‚Ç¨</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="precio" class="w-4 h-4 border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-precio" value="20-50">
                  <span class="ml-2 text-sm text-gray-700">20‚Ç¨ - 50‚Ç¨</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="precio" class="w-4 h-4 border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-precio" value="50-100">
                  <span class="ml-2 text-sm text-gray-700">50‚Ç¨ - 100‚Ç¨</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="precio" class="w-4 h-4 border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-precio" value="100+">
                  <span class="ml-2 text-sm text-gray-700">M√°s de 100‚Ç¨</span>
                </label>
              </div>
            </div>

            <!-- Vendido y enviado por -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Vendido y enviado por</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-vendedor" value="venice">
                  <span class="ml-2 text-sm text-gray-700">Venice</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-vendedor" value="terceros">
                  <span class="ml-2 text-sm text-gray-700">Vendedores externos</span>
                </label>
              </div>
            </div>

            <!-- Edad -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Edad</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-edad" value="cachorro">
                  <span class="ml-2 text-sm text-gray-700">Cachorro</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-edad" value="adulto">
                  <span class="ml-2 text-sm text-gray-700">Adulto</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-edad" value="senior">
                  <span class="ml-2 text-sm text-gray-700">Senior</span>
                </label>
              </div>
            </div>

            <!-- Tama√±o raza -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Tama√±o raza</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-tamano" value="pequeno">
                  <span class="ml-2 text-sm text-gray-700">Peque√±o</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-tamano" value="mediano">
                  <span class="ml-2 text-sm text-gray-700">Mediano</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400 filter-tamano" value="grande">
                  <span class="ml-2 text-sm text-gray-700">Grande</span>
                </label>
              </div>
            </div>

            <!-- Razas -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Razas</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3">
                <input type="text" placeholder="Buscar raza..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400" id="filter-raza">
              </div>
            </div>

            <!-- Nutrici√≥n -->
            <div class="filter-section border-b border-gray-200 py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Nutrici√≥n</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400" value="natural">
                  <span class="ml-2 text-sm text-gray-700">Natural</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400" value="sin-cereales">
                  <span class="ml-2 text-sm text-gray-700">Sin cereales</span>
                </label>
              </div>
            </div>

            <!-- Sabores -->
            <div class="filter-section py-4">
              <button class="filter-toggle flex justify-between items-center w-full text-left font-medium text-yellow-700 hover:text-yellow-800">
                <span>Sabores</span>
                <svg class="w-5 h-5 chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="filter-content mt-3 space-y-2">
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400" value="pollo">
                  <span class="ml-2 text-sm text-gray-700">Pollo</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400" value="salmon">
                  <span class="ml-2 text-sm text-gray-700">Salm√≥n</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-500 focus:ring-yellow-400" value="cordero">
                  <span class="ml-2 text-sm text-gray-700">Cordero</span>
                </label>
              </div>
            </div>
          </div>
        </aside>

        <!-- Contenido principal - Productos -->
        <div class="flex-1">
          
          <!-- Barra superior: Resultados + Ordenar -->
          <div class="flex items-center justify-between mb-6">
            <p class="text-gray-700">
              <span class="text-yellow-600 font-bold" id="results-count">{totalProducts || 0}</span> Resultados
            </p>
            <div class="flex items-center gap-2">
              <span class="text-sm text-gray-600">Ordenar por</span>
              <select id="sort-select" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 cursor-pointer">
                <option value="relevancia">Relevancia</option>
                <option value="precio-asc">Precio: menor a mayor</option>
                <option value="precio-desc">Precio: mayor a menor</option>
                <option value="nombre">Nombre A-Z</option>
                <option value="valoracion">Mejor valorados</option>
              </select>
            </div>
          </div>

          <!-- Grid de productos -->
          <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {products && products.length > 0 ? (
              products.map((product: any) => (
                <div class="product-card bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow group">
                  <!-- Badge descuento -->
                  {product.discount && (
                    <div class="absolute top-3 left-3 z-10">
                      <span class="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded">
                        -{product.discount}% Dto.
                      </span>
                    </div>
                  )}
                  
                  <!-- Imagen -->
                  <div class="relative aspect-square bg-gray-50 p-4">
                    <img 
                      src={product.image || 'https://via.placeholder.com/300x300?text=Producto'} 
                      alt={product.name}
                      class="w-full h-full object-contain group-hover:scale-105 transition-transform"
                    />
                  </div>

                  <!-- Info del producto -->
                  <div class="p-4">
                    <!-- Nombre -->
                    <h3 class="font-medium text-gray-800 mb-2 line-clamp-2 min-h-[48px]">
                      <span class="font-bold">{product.brand || 'Venice'}</span> {product.name}
                    </h3>

                    <!-- Valoraci√≥n -->
                    <div class="flex items-center gap-1 mb-2">
                      <div class="flex text-yellow-400">
                        <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                        <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                        <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                        <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                        <svg class="w-4 h-4 fill-current text-gray-300" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                      </div>
                      <span class="text-sm text-gray-500">4.8</span>
                      <span class="text-sm text-gray-400">({Math.floor(Math.random() * 200) + 50})</span>
                    </div>

                    <!-- Precio -->
                    <div class="mb-2">
                      <span class="text-xl font-bold text-gray-900">{product.price}‚Ç¨</span>
                      {product.original_price && (
                        <span class="text-sm text-gray-400 line-through ml-2">{product.original_price}‚Ç¨</span>
                      )}
                    </div>

                    <!-- Precio por kg -->
                    <p class="text-xs text-gray-500 mb-3">
                      Desde {(product.price / (product.weight || 1)).toFixed(2)}‚Ç¨ / kg
                    </p>

                    <!-- Opciones de peso -->
                    <p class="text-xs text-gray-500 border-t border-b border-gray-100 py-2 mb-3">
                      {product.weight ? `${product.weight}kg` : '3 opciones de peso'}
                    </p>

                    <!-- Vendido por -->
                    <div class="flex items-center gap-1 mb-4 text-xs text-gray-500">
                      <span class="text-yellow-500">üêæ</span>
                      Vendido por <span class="font-semibold text-yellow-600">Venice</span>
                    </div>

                    <!-- Bot√≥n a√±adir al carrito -->
                    <button 
                      class="add-to-cart w-full flex items-center justify-center gap-2 py-3 border-2 border-yellow-500 text-yellow-600 font-semibold rounded-lg hover:bg-yellow-500 hover:text-white transition-colors"
                      data-product-id={product.id}
                      data-product-name={product.name}
                      data-product-price={product.price}
                      data-product-image={product.image}
                    >
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                      </svg>
                      A√±adir al carrito
                    </button>
                  </div>
                </div>
              ))
            ) : (
              <!-- Productos de ejemplo si no hay en la DB -->
              <>
                {[
                  { name: 'Regular Sterilised 37 pienso para gatos', brand: 'Royal Canin', price: 28.59, maxPrice: 143.06, discount: 30, image: 'https://images.unsplash.com/photo-1589924691995-400dc9ecc119?w=300', rating: 4.8, reviews: 285 },
                  { name: 'Adult Chihuahua pienso para perros', brand: 'Royal Canin', price: 5.99, maxPrice: 52.90, discount: 15, image: 'https://images.unsplash.com/photo-1568640347023-a616a30bc3bd?w=300', rating: 4.8, reviews: 48 },
                  { name: 'Digestive Sensitive sobre para gatos', brand: 'Royal Canin', price: 1.29, maxPrice: 58.20, discount: 20, image: 'https://images.unsplash.com/photo-1574158622682-e40e69881006?w=300', rating: 4.6, reviews: 32 },
                  { name: 'Adult Medium pienso para perros', brand: 'Royal Canin', price: 15.99, maxPrice: 89.90, discount: 25, image: 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=300', rating: 4.9, reviews: 156 },
                  { name: 'Kitten pienso para gatitos', brand: 'Royal Canin', price: 12.49, maxPrice: 65.00, discount: 10, image: 'https://images.unsplash.com/photo-1495360010541-f48722b34f7d?w=300', rating: 4.7, reviews: 89 },
                  { name: 'Maxi Adult pienso para perros grandes', brand: 'Royal Canin', price: 45.99, maxPrice: 120.00, discount: 15, image: 'https://images.unsplash.com/photo-1552053831-71594a27632d?w=300', rating: 4.8, reviews: 234 },
                ].map((product, i) => (
                  <div class="product-card bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow group relative">
                    <!-- Badge descuento -->
                    <div class="absolute top-3 left-3 z-10">
                      <span class="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded">
                        -{product.discount}% Dto.
                      </span>
                    </div>
                    
                    <!-- Imagen -->
                    <div class="relative aspect-square bg-gray-50 p-4">
                      <img 
                        src={product.image} 
                        alt={product.name}
                        class="w-full h-full object-cover rounded group-hover:scale-105 transition-transform"
                      />
                    </div>

                    <!-- Info del producto -->
                    <div class="p-4">
                      <!-- Nombre -->
                      <h3 class="font-medium text-gray-800 mb-2 line-clamp-2 min-h-[48px]">
                        <span class="font-bold">{product.brand}</span> {product.name}
                      </h3>

                      <!-- Valoraci√≥n -->
                      <div class="flex items-center gap-1 mb-2">
                        <div class="flex text-yellow-400">
                          <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-4 h-4 fill-current text-gray-300" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                        </div>
                        <span class="text-sm text-gray-500">{product.rating}</span>
                        <span class="text-sm text-gray-400">({product.reviews})</span>
                      </div>

                      <!-- Precio -->
                      <div class="mb-2">
                        <span class="text-xl font-bold text-gray-900">{product.price}‚Ç¨</span>
                        <span class="text-gray-500 mx-1">-</span>
                        <span class="text-xl font-bold text-gray-900">{product.maxPrice}‚Ç¨</span>
                      </div>

                      <!-- Precio por kg -->
                      <p class="text-xs text-gray-500 mb-3">
                        Desde {(product.price / 2).toFixed(2)}‚Ç¨ / kg
                      </p>

                      <!-- Opciones de peso -->
                      <p class="text-xs text-gray-500 border-t border-b border-gray-100 py-2 mb-3">
                        8 opciones de peso
                      </p>

                      <!-- Vendido por -->
                      <div class="flex items-center gap-1 mb-4 text-xs text-gray-500">
                        <span class="text-yellow-500">üêæ</span>
                        Vendido por <span class="font-semibold text-yellow-600">Venice</span>
                      </div>

                      <!-- Bot√≥n a√±adir al carrito -->
                      <button 
                        class="add-to-cart w-full flex items-center justify-center gap-2 py-3 border-2 border-yellow-500 text-yellow-600 font-semibold rounded-lg hover:bg-yellow-500 hover:text-white transition-colors"
                        data-product-id={`sample-${i}`}
                        data-product-name={`${product.brand} ${product.name}`}
                        data-product-price={product.price}
                        data-product-image={product.image}
                      >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        A√±adir al carrito
                      </button>
                    </div>
                  </div>
                ))}
              </>
            )}
          </div>

          <!-- Paginaci√≥n -->
          <div class="flex items-center justify-center gap-2 mt-8">
            <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 disabled:opacity-50" disabled>
              ‚Üê Anterior
            </button>
            <button class="px-4 py-2 bg-yellow-500 text-white rounded-lg font-medium">1</button>
            <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">2</button>
            <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">3</button>
            <span class="px-2 text-gray-400">...</span>
            <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">10</button>
            <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">
              Siguiente ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .filter-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    .filter-section.open .filter-content {
      max-height: 500px;
    }
    .filter-section.open .chevron {
      transform: rotate(180deg);
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .product-card {
      position: relative;
    }
  </style>

  <script>
    // Toggle de filtros colapsables
    document.querySelectorAll('.filter-toggle').forEach(button => {
      button.addEventListener('click', () => {
        const section = button.closest('.filter-section');
        section?.classList.toggle('open');
      });
      // Abrir todos por defecto
      button.closest('.filter-section')?.classList.add('open');
    });

    // A√±adir al carrito
    document.querySelectorAll('.add-to-cart').forEach(button => {
      button.addEventListener('click', (e) => {
        const btn = e.currentTarget as HTMLButtonElement;
        const product = {
          id: btn.dataset.productId,
          name: btn.dataset.productName,
          price: parseFloat(btn.dataset.productPrice || '0'),
          image: btn.dataset.productImage,
          quantity: 1
        };

        // Obtener carrito actual
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        
        // Verificar si ya existe
        const existingIndex = cart.findIndex((p: any) => p.id === product.id);
        if (existingIndex > -1) {
          cart[existingIndex].quantity += 1;
        } else {
          cart.push(product);
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Actualizar contador del carrito
        const cartCount = document.getElementById('cart-count');
        if (cartCount) {
          const totalItems = cart.reduce((sum: number, p: any) => sum + p.quantity, 0);
          cartCount.textContent = totalItems.toString();
        }

        // Feedback visual
        btn.innerHTML = `
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          ¬°A√±adido!
        `;
        btn.classList.add('bg-green-500', 'text-white', 'border-green-500');
        
        setTimeout(() => {
          btn.innerHTML = `
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
            A√±adir al carrito
          `;
          btn.classList.remove('bg-green-500', 'text-white', 'border-green-500');
        }, 2000);
      });
    });

    // Ordenar productos
    document.getElementById('sort-select')?.addEventListener('change', (e) => {
      const value = (e.target as HTMLSelectElement).value;
      console.log('Ordenar por:', value);
    });

    // Filtros
    const filterCheckboxes = document.querySelectorAll('input[type="checkbox"], input[type="radio"]');
    filterCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        console.log('Filtros actualizados');
      });
    });

    // Actualizar contador de resultados
    const resultsCount = document.getElementById('results-count');
    if (resultsCount && resultsCount.textContent === '0') {
      resultsCount.textContent = '6';
    }
  </script>
</Layout>
